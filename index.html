<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nautilus Navigation Chart</title>
    <!-- Add Google Fonts: Space Grotesk and a decorative font for titles -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500&family=Cinzel+Decorative:wght@400;700&display=swap"
      rel="stylesheet" />
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-color: #0a1a2a;
        background-image: url("/api/placeholder/1200/800");
        background-size: cover;
        background-position: center;
        background-blend-mode: overlay;
        font-family: "Space Grotesk", sans-serif;
        color: #c9b18c;
      }
      .nautilus-container {
        position: relative;
        width: 90%;
        max-width: 800px;
        padding: 20px;
        margin: 20px 0;
        background-color: rgba(10, 26, 42, 0.85);
        border: 8px double #c9b18c;
        box-shadow: 0 0 30px rgba(0, 128, 128, 0.3);
      }
      .title-section {
        text-align: center;
        margin-bottom: 20px;
        border-bottom: 1px solid #c9b18c;
        padding-bottom: 20px;
      }
      h1 {
        font-family: "Cinzel Decorative", cursive;
        color: #c9b18c;
        margin: 0;
        font-size: 2rem;
        letter-spacing: 2px;
      }
      h2 {
        font-family: "Cinzel Decorative", cursive;
        color: #c9b18c;
        font-size: 1.2rem;
        margin: 10px 0;
        font-weight: normal;
      }
      .subtitle {
        font-style: italic;
        margin-top: 10px;
        color: #8ca5c9;
        font-size: 0.9rem;
      }
      .interactive-compass {
        display: flex;
        justify-content: center;
        margin: 20px auto;
      }
      /* Compass container styles */
      .compass-container {
        position: relative;
        width: 100px;
        height: 100px;
        cursor: pointer;
        margin: 0 auto;
      }
      /* Compass rose styles */
      .compass-rose {
        position: absolute;
        width: 100%;
        height: 100%;
        border: 2px solid #c9b18c;
        border-radius: 50%;
        background-color: rgba(10, 26, 42, 0.6);
        transition: transform 0.5s ease;
        left: 0;
        top: 0;
      }
      /* Compass needle styles - fixed to center properly */
      .compass-needle {
        position: absolute;
        top: 50%; /* Center vertically */
        left: 50%; /* Center horizontally */
        width: 2px;
        height: 70%; /* Maintain original height */
        background: linear-gradient(
          to bottom,
          #c9b18c 0%,
          #c9b18c 50%,
          #8a0000 50%,
          #8a0000 100%
        );
        transform-origin: center center; /* Rotate around center point */
        transform: translate(-50%, -50%); /* Offset to true center */
      }
      /* Compass direction container */
      .compass-direction {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      /* Direction label styles */
      .direction {
        position: absolute;
        font-size: 0.8rem;
        color: #c9b18c;
        font-weight: bold;
      }
      .direction.n {
        top: 5px;
        left: 50%;
        transform: translateX(-50%);
      }
      .direction.e {
        right: 5px;
        top: 50%;
        transform: translateY(-50%);
      }
      .direction.s {
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%);
      }
      .direction.w {
        left: 5px;
        top: 50%;
        transform: translateY(-50%);
      }
      .chart-container {
        position: relative;
        margin: 20px auto;
        width: 100%;
        max-width: 440px;
        border: 5px solid #c9b18c;
        border-radius: 5px;
        padding: 10px;
        background-color: rgba(28, 43, 53, 0.7);
        box-sizing: border-box;
      }
      canvas {
        display: block;
        margin: 0 auto;
        width: 100%;
        height: auto;
        box-shadow: 0 0 20px rgba(0, 128, 128, 0.2);
        box-sizing: border-box;
      }
      .compass {
        display: none;
      }
      .notes {
        margin-top: 30px;
        padding: 15px;
        border-top: 1px solid #c9b18c;
        font-style: italic;
        color: #8ca5c9;
        font-size: 0.9rem;
        line-height: 1.6;
      }
      .coordinates {
        position: relative;
        text-align: right;
        margin-top: 10px;
        font-family: "Space Grotesk", monospace;
        font-size: 0.8rem;
        color: #8ca5c9;
      }
      .vintage-screws {
        position: absolute;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          #c9b18c 0%,
          #8b7b5e 70%,
          #5d4e36 100%
        );
        box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.8);
      }
      .screw-1 {
        top: 15px;
        left: 15px;
      }
      .screw-2 {
        top: 15px;
        right: 15px;
      }
      .screw-3 {
        bottom: 15px;
        left: 15px;
      }
      .screw-4 {
        bottom: 15px;
        right: 15px;
      }
      .button {
        margin-top: 20px;
        text-align: center;
      }
      .button a {
        display: inline-block;
        padding: 8px 20px;
        background-color: #1a3040;
        color: #c9b18c;
        text-decoration: none;
        border: 1px solid #c9b18c;
        font-family: "Space Grotesk", sans-serif;
        transition: all 0.3s;
      }
      .button a:hover {
        background-color: #c9b18c;
        color: #1a3040;
      }

      /* Media Queries for Responsive Design */
      @media (max-width: 768px) {
        .nautilus-container {
          padding: 15px;
          border-width: 6px;
        }
        h1 {
          font-size: 1.6rem;
        }
        h2 {
          font-size: 1rem;
        }
        .chart-container {
          border-width: 3px;
          padding: 5px;
        }
        .notes {
          font-size: 0.8rem;
          margin-top: 20px;
          padding: 10px;
        }
        .vintage-screws {
          width: 8px;
          height: 8px;
        }
      }

      @media (max-width: 480px) {
        .nautilus-container {
          padding: 10px;
          border-width: 4px;
          width: 95%;
        }
        h1 {
          font-size: 1.3rem;
        }
        h2 {
          font-size: 0.9rem;
        }
        .subtitle {
          font-size: 0.8rem;
        }
        .compass-container {
          width: 80px;
          height: 80px;
        }
        .button a {
          padding: 6px 15px;
          font-size: 0.9rem;
        }
      }
    </style>
    <!-- p5.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <!-- chroma.js for color manipulation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
  </head>
  <body>
    <div class="nautilus-container">
      <div class="vintage-screws screw-1"></div>
      <div class="vintage-screws screw-2"></div>
      <div class="vintage-screws screw-3"></div>
      <div class="vintage-screws screw-4"></div>

      <div class="title-section">
        <h1>Nautilus Navigation Chart</h1>
        <div class="subtitle">
          Charted by Captain Nemo - Sector 42, Pacific Ocean
        </div>
        <h2>Depth Analysis and Terrain Mapping</h2>
      </div>

      <!-- Interactive compass -->
      <div class="interactive-compass">
        <div class="compass-container" id="compass-container">
          <div class="compass-rose" id="compass-rose">
            <div class="compass-needle" id="compass-needle"></div>
            <div class="compass-direction">
              <div class="direction n">N</div>
              <div class="direction e">E</div>
              <div class="direction s">S</div>
              <div class="direction w">W</div>
            </div>
          </div>
        </div>
      </div>

      <div class="compass"></div>

      <div class="chart-container">
        <div id="sketch-holder"></div>
      </div>

      <div class="notes">
        "The depths of the ocean hold secrets beyond imagination. This chart
        maps the underwater terrain at coordinates 24°17'N, 37°35'W, where we
        discovered remnants of ancient ruins. Numbers indicate depth in fathoms
        — proceed with caution near shallows."
        <div class="coordinates">— Captain Nemo, 1868</div>
      </div>

      <div class="button">
        <a href="#">VIEW VESSEL LOG</a>
      </div>
    </div>

    <script>
      // Interactive compass functionality - updated for random rotation on click
      document.addEventListener("DOMContentLoaded", function () {
        // Get references to DOM elements
        const compassNeedle = document.getElementById("compass-needle");
        const compassContainer = document.getElementById("compass-container");

        // Variable to track current rotation
        let currentRotation = 0;

        // Function to handle compass rotation
        function rotateCompass(degrees) {
          currentRotation = degrees;
          // Apply rotation transform, ensuring center alignment
          compassNeedle.style.transform = `translate(-50%, -50%) rotate(${degrees}deg)`;
        }

        // Initialize compass with a default position
        rotateCompass(0);

        // Add click event for random rotation
        compassContainer.addEventListener("click", function () {
          // Generate random rotation between 0 and 359 degrees
          const randomRotation = Math.floor(Math.random() * 360);
          // Apply the random rotation
          rotateCompass(randomRotation);
        });
      });

      // Make the canvas responsive
      function windowResized() {
        const container = document.querySelector(".chart-container");
        if (container) {
          const containerWidth = container.offsetWidth - 20; // Account for padding
          const canvasSize = Math.min(containerWidth, 400);
          resizeCanvas(canvasSize, canvasSize);
          redraw();
        }
      }

      // Colors to more nautical/ocean-themed palette
      let colors = [
        "#0a2d42",
        "#0a3a5c",
        "#0e4f79",
        "#126191",
        "#1975aa",
        "#1a87c4",
        "#2c607a",
        "#5a8c98",
        "#7dada5",
      ];
      let chart;
      let lines;
      let customFont = "Space Grotesk";
      let canvasSize = 400;

      // Custom noise function that doesn't rely on external library
      function customNoise(x, y) {
        // Simple Perlin-like noise as fallback
        if (typeof noise === "function" && typeof noise(0.5) === "number") {
          return noise(x, y);
        } else {
          // Simple noise function as fallback
          const seed = 42; // Fixed seed for consistency
          return Math.sin(x * 10 + seed) * Math.cos(y * 10 + seed) * 0.5 + 0.5;
        }
      }

      function setup() {
        // Create responsive canvas in the sketch-holder div
        const container = document.querySelector(".chart-container");
        if (container) {
          const containerWidth = container.offsetWidth - 20; // Account for padding
          canvasSize = min(containerWidth, 400);
        }

        let canvas = createCanvas(canvasSize, canvasSize);
        canvas.parent("sketch-holder");

        // Changed background to a more aged paper/parchment color
        background("#e8ddc2");

        // Calculate chart size based on canvas
        const chartSize = floor(canvasSize * 0.7);
        const margin = floor((canvasSize - chartSize) / 2);

        chart = createGraphics(chartSize, chartSize);
        lines = createGraphics(chartSize, chartSize);

        for (let x = 0; x <= chartSize; x++) {
          for (let y = 0; y <= chartSize; y++) {
            chart.fill(
              colorMixer(x / (chartSize / 5.6), y / (chartSize / 5.6), colors)
            );
            chart.noStroke();
            chart.rect(x, y, 1, 1);
          }
        }
        image(chart, margin, margin);

        for (let i = 0; i < 5; i++) {
          lines.clear();
          for (let x = 0; x <= chartSize; x++) {
            for (let y = 0; y <= chartSize; y++) {
              let fillIn = floor(
                customNoise(x / (chartSize / 5.6), y / (chartSize / 5.6)) *
                  colors.length
              );
              lines.fill(255);
              lines.noStroke();
              if (fillIn == i) {
                lines.rect(x, y, 1, 1);
              }
            }
          }
          push();

          try {
            lines.drawingContext.shadowBlur = 5;
            lines.drawingContext.shadowColor = "black";
          } catch (e) {
            console.log("Shadow effects not supported, skipping");
          }

          blendMode(HARD_LIGHT);
          image(lines, margin, margin);
          pop();
        }

        for (
          let x = chartSize / 18.67;
          x < chart.width;
          x += chartSize / 9.33
        ) {
          for (
            let y = chartSize / 18.67;
            y < chart.height;
            y += chartSize / 9.33
          ) {
            let xoff = random(-chartSize / 56, chartSize / 56);
            let yoff = random(-chartSize / 56, chartSize / 56);
            let newX = x + xoff;
            let newY = y + yoff;
            let c = floor(
              customNoise(newX / (chartSize / 5.6), newY / (chartSize / 5.6)) *
                colors.length
            );
            if (c < 5) {
              // Changed to show fathoms instead of elevation
              let depth = floor(map(c, 0, 4, 60, 200));
              push();
              textSize(canvasSize / 57);
              textAlign(CENTER, CENTER);
              fill(255, 245, 230);
              noStroke();
              text(depth, newX + margin, newY + margin);
              pop();
            }
          }
        }

        // Outer border/frame
        fill("#e8ddc2");
        noStroke();
        rect(0, 0, width, margin);
        rect(0, 0, margin, height);
        rect(canvasSize - margin, 0, margin, height);
        rect(0, canvasSize - margin, width, margin);

        // Add nautical scale and coordinates
        fill(70, 50, 30);
        textSize(canvasSize / 50);
        text(
          "SCALE: 1 inch = 10 nautical miles",
          canvasSize / 20,
          canvasSize - canvasSize / 10
        );
        textSize(canvasSize / 57);
        text("24°17'N, 37°35'W", canvasSize / 20, canvasSize - canvasSize / 20);

        // Add nautical compass marks around the edge
        push();
        stroke("#6d5c3d");
        strokeWeight(1);
        textAlign(CENTER, CENTER);
        textSize(canvasSize / 50);

        // North
        text("N", canvasSize / 2, canvasSize / 10);
        line(
          canvasSize / 2,
          canvasSize / 9.09,
          canvasSize / 2,
          canvasSize / 7.41
        );

        // East
        text("E", canvasSize - canvasSize / 10, canvasSize / 2);
        line(
          canvasSize - canvasSize / 9.09,
          canvasSize / 2,
          canvasSize - canvasSize / 7.41,
          canvasSize / 2
        );

        // South
        text("S", canvasSize / 2, canvasSize - canvasSize / 10);
        line(
          canvasSize / 2,
          canvasSize - canvasSize / 9.09,
          canvasSize / 2,
          canvasSize - canvasSize / 7.41
        );

        // West
        text("W", canvasSize / 10, canvasSize / 2);
        line(
          canvasSize / 9.09,
          canvasSize / 2,
          canvasSize / 7.41,
          canvasSize / 2
        );

        pop();
      }

      // Function to mix colors for the terrain
      function colorMixer(x, y, colorArray) {
        let c = customNoise(x, y) * colorArray.length;
        let c1 = floor(c);
        let c2 = floor(c + 1) % colorArray.length;
        let color1 = colorArray[c1];
        let color2 = colorArray[c2];
        let mix = fract(c);

        // Create a simple color mixing fallback if chroma.js isn't loaded
        let mixedColor;
        try {
          if (typeof chroma !== "undefined") {
            mixedColor = chroma.mix(color1, color2, mix).hex();
          } else {
            // Simple linear interpolation of hex colors
            mixedColor = lerpColor(color(color1), color(color2), mix);
          }
        } catch (e) {
          // Use first color as fallback
          mixedColor = color1;
        }

        return color(mixedColor);
      }

      // Helper function since p5.js has fract but it might not be available globally
      function fract(x) {
        return x - Math.floor(x);
      }

      // Event listener for window resize
      window.addEventListener("resize", function () {
        if (typeof windowResized === "function") {
          windowResized();
        }
      });
    </script>
  </body>
</html>
